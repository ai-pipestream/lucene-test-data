services:
  djl-serving:
    image: ${DJL_IMAGE:-deepjavalibrary/djl-serving:0.31.0-pytorch-cpu}
    ports:
      - "8091:8080"
    volumes:
      - /work/opensearch-grpc-knn:/work:ro
      - ../bge-m3-model:/opt/ml/model/bge-m3:ro
    environment:
      - MODEL_LOADING_TIMEOUT=300
      - PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True
    deploy:
      resources:
        reservations:
          devices:
            - driver: ${DOCKER_DRIVER:-none}
              count: ${GPU_COUNT:-0}
              capabilities: [gpu]
